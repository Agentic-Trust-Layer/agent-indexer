type Collection @entity(immutable: false) {
  id: Bytes!              # contract address
  name: String
  symbol: String
  totalSupply: BigInt!
}

type Token @entity(immutable: false) {
  id: Int8!               # tokenId as integer
  collection: Collection!
  owner: Account!
  mintedAt: BigInt!
  uri: String
  metadataJson: String
  agentName: String
  a2aEndpoint: String
  chatEndpoint: String
  ensName: String
  agentAccount: String
  description: String
  image: String
}

type Account @entity(immutable: false) {
  id: Bytes!              # owner address
  balance: BigInt!
  tokens: [Token!] @derivedFrom(field: "owner")
}

type Transfer @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  token: Token!
  from: Account!
  to: Account!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type UriUpdate @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  token: Token!
  newUri: String
  newUriJson: String
  updatedBy: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type TokenMetadata @entity(immutable: false) {
  id: ID!                 # tokenId-key combination
  token: Token!
  key: String!
  value: Bytes!
  indexedKey: String
  setAt: BigInt!
  setBy: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type RepFeedback @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  agentId: BigInt!
  clientAddress: Bytes!
  score: Int!
  tag1: Bytes!
  tag2: Bytes!
  feedbackUri: String
  feedbackJson: String
  feedbackType: String
  domain: String
  comment: String
  ratingPct: Int
  feedbackTimestamp: String
  feedbackHash: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type RepFeedbackRevoked @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  agentId: BigInt!
  clientAddress: Bytes!
  feedbackIndex: BigInt!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type RepResponseAppended @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  agentId: BigInt!
  clientAddress: Bytes!
  feedbackIndex: BigInt!
  responder: Bytes!
  responseUri: String
  responseJson: String
  responseHash: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type ValidationRequest @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  validatorAddress: Bytes!
  agentId: BigInt!
  requestUri: String
  requestJson: String
  requestHash: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type ValidationResponse @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  validatorAddress: Bytes!
  agentId: BigInt!
  requestHash: Bytes!
  response: Int!
  responseUri: String
  responseJson: String
  responseHash: Bytes!
  tag: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

# ----------------------------
# ERC-8092 Associations Store
# ----------------------------

type AssociationAccount @entity(immutable: false) {
  id: Bytes! # raw account bytes (may be address-like, but not necessarily 20 bytes)
  initiated: [Association!] @derivedFrom(field: "initiatorAccount")
  approved: [Association!] @derivedFrom(field: "approverAccount")
}

type Association @entity(immutable: false) {
  id: Bytes! # associationId (bytes32)

  initiatorAccount: AssociationAccount!
  approverAccount: AssociationAccount!

  initiator: Bytes!
  approver: Bytes!
  validAt: BigInt!
  validUntil: BigInt!
  interfaceId: Bytes!
  data: Bytes!

  initiatorKeyType: Bytes!
  approverKeyType: Bytes!
  initiatorSignature: Bytes!
  approverSignature: Bytes!

  revokedAt: BigInt

  createdTxHash: Bytes!
  createdBlockNumber: BigInt!
  createdTimestamp: BigInt!
  lastUpdatedTxHash: Bytes!
  lastUpdatedBlockNumber: BigInt!
  lastUpdatedTimestamp: BigInt!
}

type AssociationRevocation @entity(immutable: true) {
  id: ID! # txHash-logIndex
  associationId: Bytes!
  revokedAt: BigInt!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}