type Collection @entity(immutable: false) {
  id: Bytes!              # contract address
  name: String
  symbol: String
  totalSupply: BigInt!
}

type Agent @entity(immutable: false) {
  id: ID!                 # agentId as string (uint256)
  collection: Collection!
  owner: Account!
  mintedAt: BigInt!

  agentURI: String
  metadataJson: String

  name: String
  description: String
  image: String
  ensName: String
  agentWallet: Bytes
  a2aEndpoint: String
  chatEndpoint: String

  registration: AgentRegistrationFile
  stats: AgentStats
}

type Account @entity(immutable: false) {
  id: Bytes!              # owner address
  balance: BigInt!
  agents: [Agent!] @derivedFrom(field: "owner")
}

type AgentTransfer @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  agent: Agent!
  from: Account!
  to: Account!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type AgentURIUpdate @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  agent: Agent!
  newAgentURI: String
  newAgentURIJson: String
  updatedBy: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type AgentMetadata @entity(immutable: false) {
  id: ID!                 # agentId-key combination
  agent: Agent!
  key: String!
  value: Bytes!
  indexedKey: String
  setAt: BigInt!
  setBy: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type ValidationRequest @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  validatorAddress: Bytes!
  agent: Agent!
  requestUri: String
  requestJson: String
  requestHash: Bytes!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
  file: ValidationFile
}

type ValidationResponse @entity(immutable: true) {
  id: ID!                 # txHash-logIndex
  validatorAddress: Bytes!
  agent: Agent!
  requestHash: Bytes!
  response: Int!
  responseUri: String
  responseJson: String
  responseHash: Bytes!
  tag: String!
  txHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
  file: ValidationFile
}

type AgentRegistrationFile @entity(immutable: false) {
  id: ID!                 # agentId (string)
  agent: Agent!
  agentURI: String
  raw: String
  type: String
  name: String
  description: String
  image: String
  supportedTrust: [String!]!
  a2aEndpoint: String
  chatEndpoint: String
  ensName: String
  updatedAt: BigInt!
}

type ValidationFile @entity(immutable: true) {
  id: ID!                 # txHash:cidOrUri
  agent: Agent!
  validatorAddress: Bytes!
  requestHash: Bytes!
  requestUri: String
  responseUri: String
  cid: String
  requestRaw: String
  responseRaw: String
  tag: String
  createdAt: BigInt!
}

type AgentStats @entity(immutable: false) {
  id: ID!                 # agentId (string)
  agent: Agent!
  totalFeedback: BigInt!
  totalValidations: BigInt!
  lastActivity: BigInt!
  updatedAt: BigInt!
  tags: [String!]!
}

type GlobalStats @entity(immutable: false) {
  id: ID!                 # "global"
  totalAgents: BigInt!
  totalFeedback: BigInt!
  totalValidations: BigInt!
  tags: [String!]!
  updatedAt: BigInt!
}
